{"version":3,"sources":["api/game.worker.js","fs.js","api/load_spawn.js","api/loader.js","api/sound.js","App.js","index.js"],"names":["module","exports","Worker","__webpack_require__","p","_callee","store","files","_i","_Object$entries","_ref3","_ref2","name","data","regenerator_default","a","wrap","_context","prev","next","IdbKvStore","Map","t0","Object","json","t1","sent","entries","call","length","slicedToArray","set","abrupt","update","delete","remove","t2","Promise","resolve","stop","SpawnSize","load_spawn","_x","_x2","_load_spawn","apply","this","arguments","api","fs","file","spawn","get","byteLength","axios","request","url","responseType","onDownloadProgress","e","onProgress","type","loaded","total","headers","Cache-Control","Error","Uint8Array","audio","mpq","reject","worker","addEventListener","_ref","action","func","_len","params","Array","_key","postMessage","onRender","batch","toConsumableArray","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","done","value","err","return","setCursorPos","x","y","openKeyboard","open","onError","error","load_game","do_load_game","AudioContext","window","webkitAudioContext","create_sound","duplicate_sound","play_sound","set_volume","stop_sound","delete_sound","context","sounds","id","channels","rate","buffer","createBuffer","i","copyToChannel","subarray","gain","createGain","panner","StereoPannerNode","pan","srcId","src","volume","loop","source","Math","pow","relVolume","createBufferSource","connect","destination","start","init_sound","TOUCH_MOVE","TOUCH_RMB","Link","children","props","objectWithoutProperties","react_default","createElement","assign","target","rel","App","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","state","started","loading","touch","dropping","cursorPos","touchButtons","touchCtx","touchMods","touchBelt","_create_fs","create_fs","assertThisInitialized","onDrop","dataTransfer","items","kind","getAsFile","getDropFile","preventDefault","setState","onDragEnter","setDropping","onDragOver","isDropFile","onDragLeave","onResize","document","exitPointerLock","onPointerLockChange","screen","innerHeight","height","pointerLocked","game","onMouseMove","canvas","_this$mousePos","mousePos","eventMods","onMouseDown","_this$mousePos2","requestPointerLock","mouseButton","onMouseUp","_this$mousePos3","onKeyDown","keyCode","key","charCodeAt","onMenu","onKeyUp","_this2","text","keyboard","values","map","_","concat","parseFile","touchButton","touchCanvas","onFullscreenChange","fullscreenElement","element","onTouchStart","updateTouchButton","touches","_this$mousePos4","onTouchMove","_this$mousePos5","onTouchEnd","prevTc","_this$mousePos6","requestFullscreen","setCanvas","setElement","setKeyboard","setTouch0","setTouch_","bind","setTouch1","setTouch2","setTouch3","setTouchBelt_","setTouch4","setTouch5","inc","max","focus","blur","_this3","rect","getBoundingClientRect","left","right","top","bottom","setTimeout","progress","idx","slot","style","display","drawImage","images","_ref4","clip","belt","ctx","renderer","_ref8","w","h","image","createImageData","putImageData","save","font","x0","y0","x1","y1","beginPath","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_ref7","str","color","r","g","b","fillStyle","fillText","restore","used","Set","pos","has","drawBelt","add","_this4","removeEventListener","getContext","alpha","then","passive","capture","message","pointerLockElement","mozPointerLockElement","min","movementX","movementY","clientX","clientY","round","button","shiftKey","ctrlKey","altKey","index","use","classList","toggle","now","performance","beltTime","release","_this5","touchOther","btn","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_loop","_ref9","identifier","stick","find","t","panPos","v","indexOf","original","_iterator3","_ret","setTouchMod","dx","dy","step","offsetHeight","abs","width","appendChild","_this6","_this$state","className","classNames","ref","active","App_Link","href","htmlFor","onClick","download","accept","onChange","React","Component","ReactDOM","render","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.69a5caaa.chunk.js","sourcesContent":["module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"a74021d951bb99f74fbe.worker.js\");\n};","import IdbKvStore from  'idb-kv-store';\r\n\r\nexport default async function create_fs() {\r\n  try {\r\n    const store = new IdbKvStore('diablo_fs');\r\n    const files = new Map();\r\n    for (let [name, data] of Object.entries(await store.json())) {\r\n      files.set(name, data);\r\n    }\r\n    return {\r\n      files,\r\n      update: (name, data) => store.set(name, data),\r\n      delete: name => store.remove(name),\r\n    };\r\n  } catch (e) {\r\n    return {\r\n      files: new Map(),\r\n      update: () => Promise.resolve(),\r\n      delete: () => Promise.resolve(),\r\n    };\r\n  }  \r\n}\r\n","import axios from 'axios';\r\n\r\nconst SpawnSize = 50274091;\r\n\r\nexport default async function load_spawn(api, fs) {\r\n  let file = fs.files.get('spawn.mpq');\r\n  if (file && file.byteLength !== SpawnSize) {\r\n    fs.files.delete('spawn.mpq');\r\n    await fs.delete('spawn.mpq');\r\n    file = null;\r\n  }\r\n  if (!file) {\r\n    const spawn = await axios.request({\r\n      url: '/spawn.mpq',\r\n      responseType: 'arraybuffer',\r\n      onDownloadProgress: e => {\r\n        if (api.onProgress) {\r\n          api.onProgress({type: 'spawn', loaded: e.loaded, total: e.total || SpawnSize});\r\n        }\r\n      },\r\n      headers: {\r\n        'Cache-Control': 'max-age=31536000'\r\n      }\r\n    });\r\n    if (spawn.data.byteLength !== SpawnSize) {\r\n      throw Error(\"Invalid spawn.mpq size. Try clearing cache and refreshing the page.\");\r\n    }\r\n    const data = new Uint8Array(spawn.data);\r\n    fs.files.set('spawn.mpq', data);\r\n    fs.update('spawn.mpq', data);\r\n  }\r\n  return fs;\r\n}\r\n","import Worker from './game.worker.js';\r\nimport init_sound from './sound';\r\nimport load_spawn from './load_spawn';\r\n\r\nasync function do_load_game(api, audio, mpq) {\r\n  const fs = await api.fs;\r\n  if (mpq) {\r\n    fs.files.delete('spawn.mpq');\r\n  } else {\r\n    await load_spawn(api, fs);\r\n  }\r\n  return await new Promise((resolve, reject) => {\r\n    try {\r\n      const worker = new Worker();\r\n      worker.addEventListener(\"message\", ({data}) => {\r\n        switch (data.action) {\r\n        case \"loaded\":\r\n          resolve((func, ...params) => worker.postMessage({action: \"event\", func, params}));\r\n          break;\r\n        case \"render\":\r\n          api.onRender(data.batch);\r\n          break;\r\n        case \"audio\":\r\n          audio[data.func](...data.params);\r\n          break;\r\n        case \"audioBatch\":\r\n          for (let {func, params} of data.batch) {\r\n            audio[func](...params);\r\n          }\r\n          break;\r\n        case \"fs\":\r\n          fs[data.func](...data.params);\r\n          break;\r\n        case \"cursor\":\r\n          api.setCursorPos(data.x, data.y);\r\n          break;\r\n        case \"keyboard\":\r\n          api.openKeyboard(data.open);\r\n          break;\r\n        case \"error\":\r\n          api.onError(data.error);\r\n          break;\r\n        case \"failed\":\r\n          reject(Error(data.error));\r\n          break;\r\n        default:\r\n        }\r\n      });\r\n      worker.postMessage({action: \"init\", files: fs.files, mpq});\r\n      delete fs.files;\r\n    } catch (e) {\r\n      reject(e);\r\n    }\r\n  });\r\n}\r\n\r\nexport default function load_game(api, mpq) {\r\n  const audio = init_sound();\r\n  return do_load_game(api, audio, mpq);\r\n}\r\n","function no_sound() {\r\n  return {\r\n    create_sound: () => 0,\r\n    duplicate_sound: () => 0,\r\n    play_sound: () => undefined,\r\n    set_volume: () => undefined,\r\n    stop_sound: () => undefined,\r\n    delete_sound: () => undefined,\r\n  };\r\n}\r\n\r\nexport default function init_sound() {\r\n  const AudioContext = window.AudioContext || window.webkitAudioContext;\r\n  if (!AudioContext) {\r\n    return no_sound();\r\n  }\r\n\r\n  const context = new AudioContext();\r\n  const sounds = new Map();\r\n\r\n  return {\r\n    create_sound(id, data, length, channels, rate) {\r\n      const buffer = context.createBuffer(channels, length, rate);\r\n      for (let i = 0; i < channels; ++i) {\r\n        buffer.copyToChannel(data.subarray(i * length, i * length + length), i);\r\n      }\r\n      sounds.set(id, {\r\n        buffer,\r\n        gain: context.createGain(),\r\n        panner: new StereoPannerNode(context, {pan: 0}),\r\n      });\r\n    },\r\n    duplicate_sound(id, srcId) {\r\n      const src = sounds.get(srcId);\r\n      if (!src) {\r\n        return;\r\n      }\r\n      sounds.set(id, {\r\n        buffer: src.buffer,\r\n        gain: context.createGain(),\r\n        panner: new StereoPannerNode(context, {pan: 0}),\r\n      });\r\n    },\r\n    play_sound(id, volume, pan, loop) {\r\n      const src = sounds.get(id);\r\n      if (src) {\r\n        if (src.source) {\r\n          src.source.stop();\r\n        }\r\n        src.gain.gain.value = Math.pow(2.0, volume / 1000.0);\r\n        const relVolume = Math.pow(2.0, pan / 1000.0);\r\n        src.panner.pan.value = 1.0 - 2.0 / (1.0 + relVolume);\r\n        src.source = context.createBufferSource();\r\n        src.source.buffer = src.buffer;\r\n        src.source.loop = !!loop;\r\n        src.source.connect(src.gain).connect(src.panner).connect(context.destination);\r\n        src.source.start();\r\n      }\r\n    },\r\n    set_volume(id, volume) {\r\n      const src = sounds.get(id);\r\n      if (src) {\r\n        src.gain.gain.value = Math.pow(2.0, volume / 1000.0);\r\n      }\r\n    },\r\n    stop_sound(id) {\r\n      const src = sounds.get(id);\r\n      if (src && src.source) {\r\n        src.source.stop();\r\n        delete src.source;\r\n      }\r\n    },\r\n    delete_sound(id) {\r\n      const src = sounds.get(id);\r\n      if (src && src.source) {\r\n        src.source.stop();\r\n      }\r\n      sounds.delete(id);\r\n    },\r\n  };\r\n}\r\n","import React from 'react';\r\nimport './App.scss';\r\nimport classNames from 'classnames';\r\n\r\nimport create_fs from './fs';\r\nimport load_game from './api/loader';\r\n\r\nfunction isDropFile(e) {\r\n  if (e.dataTransfer.items) {\r\n    for (let i = 0; i < e.dataTransfer.items.length; ++i) {\r\n      if (e.dataTransfer.items[i].kind === \"file\") {\r\n        return true;\r\n      }\r\n    }\r\n  } if (e.dataTransfer.files.length) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\nfunction getDropFile(e) {\r\n  if (e.dataTransfer.items) {\r\n    for (let i = 0; i < e.dataTransfer.items.length; ++i) {\r\n      if (e.dataTransfer.items[i].kind === \"file\") {\r\n        return e.dataTransfer.items[i].getAsFile();\r\n      }\r\n    }\r\n  } if (e.dataTransfer.files.length) {\r\n    return e.dataTransfer.files[0];\r\n  }\r\n}\r\n\r\nconst TOUCH_MOVE = 0;\r\nconst TOUCH_RMB = 1;\r\nconst TOUCH_SHIFT = 2;\r\n\r\nconst Link = ({children, ...props}) => <a target=\"_blank\" rel=\"noopener noreferrer\" {...props}>{children}</a>;\r\n\r\nclass App extends React.Component {\r\n  files = new Map();\r\n  state = {started: false, loading: false, touch: false, dropping: 0};\r\n  cursorPos = {x: 0, y: 0};\r\n\r\n  touchButtons = [null, null, null, null, null, null];\r\n  touchCtx = [null, null, null, null, null, null];\r\n  touchMods = [false, false, false, false, false, false];\r\n  touchBelt = [-1, -1, -1, -1, -1, -1];\r\n\r\n  fs = create_fs(this);\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.setTouch0 = this.setTouch_.bind(this, 0);\r\n    this.setTouch1 = this.setTouch_.bind(this, 1);\r\n    this.setTouch2 = this.setTouch_.bind(this, 2);\r\n    this.setTouch3 = this.setTouchBelt_.bind(this, 3);\r\n    this.setTouch4 = this.setTouchBelt_.bind(this, 4);\r\n    this.setTouch5 = this.setTouchBelt_.bind(this, 5);\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"drop\", this.onDrop, true);\r\n    document.addEventListener(\"dragover\", this.onDragOver, true);\r\n    document.addEventListener(\"dragenter\", this.onDragEnter, true);\r\n    document.addEventListener(\"dragleave\", this.onDragLeave, true);\r\n  }\r\n\r\n  onDrop = e => {\r\n    const file = getDropFile(e);\r\n    if (file) {\r\n      e.preventDefault();\r\n      this.start(file);\r\n    }\r\n    this.setState({dropping: 0});\r\n  }\r\n  onDragEnter = e => {\r\n    e.preventDefault();\r\n    this.setDropping(1);\r\n  }\r\n  onDragOver = e => {\r\n    if (isDropFile(e)) {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n  onDragLeave = e => {\r\n    this.setDropping(-1);\r\n  }\r\n  setDropping(inc) {\r\n    this.setState(({dropping}) => ({dropping: Math.max(dropping + inc, 0)}));\r\n  }\r\n\r\n  onError(text) {\r\n    this.setState({error: text});\r\n  }\r\n\r\n  openKeyboard(open) {\r\n    if (open) {\r\n      this.keyboard.focus();\r\n    } else {\r\n      this.keyboard.blur();\r\n    }\r\n  }\r\n\r\n  setCursorPos(x, y) {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    this.cursorPos = {\r\n      x: rect.left + (rect.right - rect.left) * x / 640,\r\n      y: rect.top + (rect.bottom - rect.top) * y / 480,\r\n    };\r\n    setTimeout(() => {\r\n      this.game(\"DApi_Mouse\", 0, 0, 0, x, y);\r\n    });\r\n  }\r\n\r\n  onProgress({type, loaded, total}) {\r\n    this.setState({progress: loaded / total});\r\n  }\r\n\r\n  drawBelt(idx, slot) {\r\n    if (!this.touchButtons[idx]) {\r\n      return;\r\n    }\r\n    this.touchBelt[idx] = slot;\r\n    if (slot >= 0) {\r\n      this.touchButtons[idx].style.display = \"block\";\r\n      this.touchCtx[idx].drawImage(this.canvas, 205 + 29 * slot, 357, 28, 28, 0, 0, 28, 28);\r\n    } else {\r\n      this.touchButtons[idx].style.display = \"none\";\r\n    }\r\n  }\r\n\r\n  onRender({images, text, clip, belt}) {\r\n    const ctx = this.renderer;\r\n    if (!ctx) {\r\n      return;\r\n    }\r\n    for (let {x, y, w, h, image, data} of images) {\r\n      if (!image) {\r\n        image = ctx.createImageData(w, h);\r\n        image.data.set(data);\r\n      }\r\n      ctx.putImageData(image, x, y);\r\n    }\r\n    if (text.length) {\r\n      ctx.save();\r\n      ctx.font = 'bold 13px Times New Roman';\r\n      if (clip) {\r\n        const {x0, y0, x1, y1} = clip;\r\n        ctx.beginPath();\r\n        ctx.rect(x0, y0, x1 - x0, y1 - y0);\r\n        ctx.clip();\r\n      }\r\n      for (let {x, y, text: str, color} of text) {\r\n        const r = ((color >> 16) & 0xFF);\r\n        const g = ((color >> 8) & 0xFF);\r\n        const b = (color & 0xFF);\r\n        ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;\r\n        ctx.fillText(str, x, y + 22);\r\n      }\r\n      ctx.restore();\r\n    }\r\n    if (belt) {\r\n      const used = new Set();\r\n      let pos = 3;\r\n      for (let i = 0; i < belt.length && pos < 6; ++i) {\r\n        if (belt[i] >= 0 && !used.has(belt[i])) {\r\n          this.drawBelt(pos++, i);\r\n          used.add(belt[i]);\r\n        }\r\n      }\r\n      for (; pos < 6; ++pos) {\r\n        this.drawBelt(pos, -1);\r\n      }\r\n    } else {\r\n      this.drawBelt(3, -1);\r\n      this.drawBelt(4, -1);\r\n      this.drawBelt(5, -1);\r\n    }\r\n  }\r\n\r\n  start(file) {\r\n    document.removeEventListener(\"drop\", this.onDrop, true);\r\n    document.removeEventListener(\"dragover\", this.onDragOver, true);\r\n    document.removeEventListener(\"dragenter\", this.onDragEnter, true);\r\n    document.removeEventListener(\"dragleave\", this.onDragLeave, true);\r\n    this.setState({dropping: 0});\r\n\r\n    this.renderer = this.canvas.getContext(\"2d\", {alpha: false});\r\n    this.setState({loading: true});\r\n\r\n    load_game(this, file).then(game => {\r\n      this.game = game;\r\n\r\n      document.addEventListener('mousemove', this.onMouseMove, true);\r\n      document.addEventListener('mousedown', this.onMouseDown, true);\r\n      document.addEventListener('mouseup', this.onMouseUp, true);\r\n      document.addEventListener('keydown', this.onKeyDown, true);\r\n      document.addEventListener('keyup', this.onKeyUp, true);\r\n      document.addEventListener('contextmenu', this.onMenu, true);\r\n\r\n      document.addEventListener('touchstart', this.onTouchStart, {passive: false, capture: true});\r\n      document.addEventListener('touchmove', this.onTouchMove, {passive: false, capture: true});\r\n      document.addEventListener('touchend', this.onTouchEnd, {passive: false, capture: true});\r\n\r\n      document.addEventListener('pointerlockchange', this.onPointerLockChange);\r\n      document.addEventListener('fullscreenchange', this.onFullscreenChange);\r\n      window.addEventListener('resize', this.onResize);\r\n\r\n      this.setState({started: true});\r\n    }, e => this.onError(e.message));\r\n  }\r\n\r\n  pointerLocked() {\r\n    return document.pointerLockElement === this.canvas || document.mozPointerLockElement === this.canvas;\r\n  }\r\n\r\n  mousePos(e) {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    if (this.pointerLocked()) {\r\n      this.cursorPos.x = Math.max(rect.left, Math.min(rect.right, this.cursorPos.x + e.movementX));\r\n      this.cursorPos.y = Math.max(rect.top, Math.min(rect.bottom, this.cursorPos.y + e.movementY));\r\n    } else {\r\n      this.cursorPos = {x: e.clientX, y: e.clientY};\r\n    }\r\n    return {\r\n      x: Math.max(0, Math.min(Math.round((this.cursorPos.x - rect.left) / (rect.right - rect.left) * 640), 639)),\r\n      y: Math.max(0, Math.min(Math.round((this.cursorPos.y - rect.top) / (rect.bottom - rect.top) * 480), 479)),\r\n    };\r\n  }\r\n\r\n  mouseButton(e) {\r\n    switch (e.button) {\r\n    case 0: return 1;\r\n    case 1: return 4;\r\n    case 2: return 2;\r\n    case 3: return 5;\r\n    case 4: return 6;\r\n    default: return 1;\r\n    }\r\n  }\r\n  eventMods(e) {\r\n    return ((e.shiftKey || this.touchMods[TOUCH_SHIFT]) ? 1 : 0) + (e.ctrlKey ? 2 : 0) + (e.altKey ? 4 : 0) + (e.touches ? 8 : 0);\r\n  }\r\n\r\n  onResize = () => {\r\n    document.exitPointerLock();\r\n  }\r\n\r\n  onPointerLockChange = () => {\r\n    if (window.screen && window.innerHeight === window.screen.height && !this.pointerLocked()) {\r\n      // assume that the user pressed escape\r\n      this.game(\"DApi_Key\", 0, 0, 27);\r\n      this.game(\"DApi_Key\", 1, 0, 27);\r\n    }\r\n  }\r\n\r\n  onMouseMove = e => {\r\n    if (!this.canvas) return;\r\n    const {x, y} = this.mousePos(e);\r\n    this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\r\n    e.preventDefault();\r\n  }\r\n\r\n  onMouseDown = e => {\r\n    if (!this.canvas) return;\r\n    const {x, y} = this.mousePos(e);\r\n    if (window.screen && window.innerHeight === window.screen.height) {\r\n      // we're in fullscreen, let's get pointer lock!\r\n      if (!this.pointerLocked()) {\r\n        this.canvas.requestPointerLock();\r\n      }\r\n    }\r\n    this.game(\"DApi_Mouse\", 1, this.mouseButton(e), this.eventMods(e), x, y);\r\n    e.preventDefault();\r\n  }\r\n\r\n  onMouseUp = e => {\r\n    if (!this.canvas) return;\r\n    const {x, y} = this.mousePos(e);\r\n    this.game(\"DApi_Mouse\", 2, this.mouseButton(e), this.eventMods(e), x, y);\r\n    e.preventDefault();\r\n  }\r\n\r\n  onKeyDown = e => {\r\n    if (!this.canvas) return;\r\n    this.game(\"DApi_Key\", 0, this.eventMods(e), e.keyCode);\r\n    if (e.keyCode >= 32 && e.key.length === 1) {\r\n      this.game(\"DApi_Char\", e.key.charCodeAt(0));\r\n    }\r\n  }\r\n\r\n  onMenu = e => {\r\n    e.preventDefault();\r\n  }\r\n\r\n  onKeyUp = e => {\r\n    if (!this.canvas) return;\r\n    this.game(\"DApi_Key\", 1, this.eventMods(e), e.keyCode);\r\n    const text = this.keyboard.value;\r\n    const values = [...Array(15)].map((_, i) => i < text.length ? text.charCodeAt(i) : 0);\r\n    this.game(\"DApi_SyncText\", ...values);\r\n  }\r\n\r\n  parseFile = e => {\r\n    const files = e.target.files;\r\n    if (files.length > 0) {\r\n      this.start(files[0]);\r\n    }\r\n  }\r\n\r\n  touchButton = null;\r\n  touchCanvas = null;\r\n\r\n  onFullscreenChange = () => {\r\n    this.setState({touch: (document.fullscreenElement === this.element)});\r\n  }\r\n\r\n  setTouchMod(index, value, use) {\r\n    if (index < 3) {\r\n      this.touchMods[index] = value;\r\n      if (this.touchButtons[index]) {\r\n        this.touchButtons[index].classList.toggle(\"active\", value);\r\n      }\r\n    } else if (use && this.touchBelt[index] >= 0) {\r\n      const now = performance.now();\r\n      if (!this.beltTime || now - this.beltTime > 750) {\r\n        this.game(\"DApi_Char\", 49 + this.touchBelt[index]);\r\n        this.beltTime = now;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateTouchButton(touches, release) {\r\n    let touchOther = null;\r\n    const btn = this.touchButton;\r\n    for (let {target, identifier, clientX, clientY} of touches) {\r\n      if (btn && btn.id === identifier && this.touchButtons[btn.index] === target) {\r\n        if (touches.length > 1) {\r\n          btn.stick = false;\r\n        }\r\n        btn.clientX = clientX;\r\n        btn.clientY = clientY;\r\n        this.touchCanvas = [...touches].find(t => t.identifier !== identifier);\r\n        if (this.touchCanvas) {\r\n          this.touchCanvas = {clientX: this.touchCanvas.clientX, clientY: this.touchCanvas.clientY};\r\n        }\r\n        delete this.panPos;\r\n        return this.touchCanvas != null;\r\n      }\r\n      const idx = this.touchButtons.indexOf(target);\r\n      if (idx >= 0 && !touchOther) {\r\n        touchOther = {id: identifier, index: idx, stick: true, original: this.touchMods[idx], clientX, clientY};\r\n      }\r\n    }\r\n    if (btn && !touchOther && release && btn.stick) {\r\n      const rect = this.touchButtons[btn.index].getBoundingClientRect();\r\n      const {clientX, clientY} = btn;\r\n      if (clientX >= rect.left && clientX < rect.right && clientY >= rect.top && clientY < rect.bottom) {\r\n        this.setTouchMod(btn.index, !btn.original, true);\r\n      } else {\r\n        this.setTouchMod(btn.index, btn.original);\r\n      }\r\n    } else if (btn) {\r\n      this.setTouchMod(btn.index, false);\r\n    }\r\n    this.touchButton = touchOther;\r\n    if (touchOther) {\r\n      this.setTouchMod(touchOther.index, true);\r\n      delete this.panPos;\r\n    } else if (touches.length === 2) {\r\n      const x = (touches[1].clientX + touches[0].clientX) / 2, y = (touches[1].clientY + touches[0].clientY) / 2;\r\n      if (this.panPos) {\r\n        const dx = x - this.panPos.x, dy = y - this.panPos.y;\r\n        const step = this.canvas.offsetHeight / 12;\r\n        if (Math.max(Math.abs(dx), Math.abs(dy)) > step) {\r\n          let key;\r\n          if (Math.abs(dx) > Math.abs(dy)) {\r\n            key = (dx > 0 ? 0x25 : 0x27);\r\n          } else {\r\n            key = (dy > 0 ? 0x26 : 0x28);\r\n          }\r\n          this.game(\"DApi_Key\", 0, 0, key);\r\n          // key up is ignored anyway\r\n          this.panPos = {x, y};\r\n        }\r\n      } else {\r\n        this.game(\"DApi_Mouse\", 0, 0, 24, 320, 180);\r\n        this.game(\"DApi_Mouse\", 2, 1, 24, 320, 180);\r\n        this.panPos = {x, y};\r\n      }\r\n      this.touchCanvas = null;\r\n      return false;\r\n    } else {\r\n      delete this.panPos;\r\n    }\r\n    this.touchCanvas = [...touches].find(t => !touchOther || t.identifier !== touchOther.id);\r\n    if (this.touchCanvas) {\r\n      this.touchCanvas = {clientX: this.touchCanvas.clientX, clientY: this.touchCanvas.clientY};\r\n    }\r\n    return this.touchCanvas != null;\r\n  }\r\n\r\n  onTouchStart = e => {\r\n    if (!this.canvas) return;\r\n    e.preventDefault();\r\n    if (this.updateTouchButton(e.touches, false)) {\r\n      const {x, y} = this.mousePos(this.touchCanvas);\r\n      this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\r\n      if (!this.touchMods[TOUCH_MOVE]) {\r\n        this.game(\"DApi_Mouse\", 1, this.touchMods[TOUCH_RMB] ? 2 : 1, this.eventMods(e), x, y);\r\n      }\r\n    }\r\n  }\r\n  onTouchMove = e => {\r\n    if (!this.canvas) return;\r\n    e.preventDefault();\r\n    if (this.updateTouchButton(e.touches, false)) {\r\n      const {x, y} = this.mousePos(this.touchCanvas);\r\n      this.game(\"DApi_Mouse\", 0, 0, this.eventMods(e), x, y);\r\n    }\r\n  }\r\n  onTouchEnd = e => {\r\n    if (!this.canvas) return;\r\n    e.preventDefault();\r\n    const prevTc = this.touchCanvas;\r\n    this.updateTouchButton(e.touches, true);\r\n    if (prevTc && !this.touchCanvas) {\r\n      const {x, y} = this.mousePos(prevTc);\r\n      this.game(\"DApi_Mouse\", 2, 1, this.eventMods(e), x, y);\r\n      this.game(\"DApi_Mouse\", 2, 2, this.eventMods(e), x, y);\r\n    }\r\n    if (!document.fullscreenElement) {\r\n      this.element.requestFullscreen();\r\n    }\r\n  }\r\n\r\n  setCanvas = e => this.canvas = e;\r\n  setElement = e => this.element = e;\r\n  setKeyboard = e => this.keyboard = e;\r\n  setTouch_(i, e) {\r\n    this.touchButtons[i] = e;\r\n  }\r\n  setTouchBelt_(i, e) {\r\n    this.touchButtons[i] = e;\r\n    if (e) {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = 28;\r\n      canvas.height = 28;\r\n      e.appendChild(canvas);\r\n      this.touchCtx[i] = canvas.getContext(\"2d\");\r\n    } else {\r\n      this.touchCtx[i] = null;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {started, loading, error, progress, dropping, touch} = this.state;\r\n    return (\r\n      <div className={classNames(\"App\", {touch, started, dropping})} ref={this.setElement}>\r\n        <div className=\"touch-ui touch-mods\">\r\n          <div className={classNames(\"touch-button\", \"touch-button-0\", {active: this.touchMods[0]})} ref={this.setTouch0}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-1\", {active: this.touchMods[1]})} ref={this.setTouch1}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-2\", {active: this.touchMods[2]})} ref={this.setTouch2}/>\r\n        </div>\r\n        <div className=\"touch-ui touch-belt\">\r\n          <div className={classNames(\"touch-button\", \"touch-button-0\")} ref={this.setTouch3}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-1\")} ref={this.setTouch4}/>\r\n          <div className={classNames(\"touch-button\", \"touch-button-2\")} ref={this.setTouch5}/>\r\n        </div>\r\n        <div className=\"Body\">\r\n          {!error && (\r\n            <canvas ref={this.setCanvas} width={640} height={480}/>\r\n          )}\r\n        </div>\r\n        <div className=\"BodyV\">\r\n          <input type=\"text\" className=\"keyboard\" ref={this.setKeyboard}/>\r\n          {!!error && (\r\n            <div className=\"error\">{error}</div>\r\n          )}\r\n          {!!loading && !started && !error && (\r\n            <div className=\"loading\">\r\n              Loading...\r\n              {progress != null && <span className=\"progressBar\"><span><span style={{width: `${Math.round(100 * progress)}%`}}/></span></span>}\r\n            </div>\r\n          )}\r\n          {!started && !loading && !error && (\r\n            <div className=\"start\">\r\n              <p>\r\n                This is a web port of the original Diablo game, based on source code reconstructed by\r\n                GalaXyHaXz and devilution team: <Link href=\"https://github.com/diasurgical/devilution\">https://github.com/diasurgical/devilution</Link>\r\n              </p>\r\n              <form>\r\n                <p>\r\n                  If you own the original game, you can drop the original DIABDAT.MPQ onto this page (or <label htmlFor=\"loadFile\" className=\"link\" onClick={this.download}>click here</label>)\r\n                  to start playing. The game can be purchased from <Link href=\"https://www.gog.com/game/diablo\">GoG</Link>.\r\n                </p>\r\n                <input accept=\".mpq\" type=\"file\" id=\"loadFile\" style={{display: \"none\"}} onChange={this.parseFile}/>\r\n              </form>\r\n              <p>\r\n                Or you can download and play the shareware version instead (50MB download).\r\n              </p>\r\n              <span className=\"startButton\" onClick={() => this.start()}>Play Shareware</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './reset.css';\r\n\r\nimport App from './App';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n"],"sourceRoot":""}